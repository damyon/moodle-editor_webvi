YUI.add("moodle-editor_contenteditable-editor",function(e,n){function r(){var e=[];return e.backgroundColor="rgb(90,90,90)",e.statusBackgroundColor="rgb(30,30,30)",e.borderColor="rgb(0,0,0)",e.borderWidth=3,e.paddingWidth=3,e.textColor="rgb(255,255,255)",e.statusTextColor="rgb(255,255,255)",e.editCursorColor="rgb(180,180,255)",e.eolCursorColor="rgb(255,255,180)",e.visualCursorColor="rgb(180,255,180)",e.lineWrapColor="rgb(255,255,0)",e.font="12px monospace",e}function s(e){e.currentTextBuffer=e.currentTextBuffer.replace("\r\n","\n"),e.currentTextBuffer.charAt(e.currentTextBuffer.length-1)!="\n"&&(e.currentTextBuffer+="\n",e.hiddenInput.value=e.currentTextBuffer),lines=e.currentTextBuffer.split("\n"),e.cursorPosition.y>=lines.length-1&&(e.cursorPosition.y=lines.length-2),e.cursorPosition.y<0&&(e.cursorPosition.y=0),e.cursorPosition.x>lines[e.cursorPosition.y].length&&(e.cursorPosition.x=lines[e.cursorPosition.y].length),e.cursorPosition.x<0&&(e.cursorPosition.x=0),V(e)}function o(e){e.cursorPosition.y--,s(e)}function u(e){e.cursorPosition.y++,s(e)}function a(e){e.cursorPosition.x--,s(e)}function f(e){e.currentTextBuffer=e.currentTextBuffer.replace("\r\n","\n"),lines=e.currentTextBuffer.split("\n"),e.cursorPosition.x=lines[e.cursorPosition.y].length,s(e)}function l(e,t){e.currentTextBuffer=e.currentTextBuffer.replace("\r\n","\n"),lines=e.currentTextBuffer.split("\n"),e.cursorPosition.x=0;if(t)while(e.cursorPosition.x<lines[e.cursorPosition.y].length&&lines[e.cursorPosition.y].charAt(e.cursorPosition.x)==" ")e.cursorPosition.x++;s(e)}function c(e,t){lines=t.currentTextBuffer.split("\n");var n=0;for(var r=0;r<e.y;r++)n+=lines[r].length+1;return n+=e.x,n}function h(e){lines=e.currentTextBuffer.split("\n");var t=0;for(var n=0;n<e.cursorPosition.y;n++)t+=lines[n].length+1;return t+=e.cursorPosition.x,t}function p(e){var t=h(e),n=e.currentTextBuffer.substring(t)+"\n"+e.currentTextBuffer.substring(0,t),r=n.search(/[^\w]\w/);while(r-->=0)v(e);s(e)}function d(e){lines=e.currentTextBuffer.split("\n"),e.cursorPosition.x--,e.cursorPosition.x<0&&(e.cursorPosition.y--,e.cursorPosition.y<0&&(e.cursorPosition.y=lines.length-1),e.cursorPosition.x=F(e.cursorPosition.y)),s(e)}function v(e){lines=e.currentTextBuffer.split("\n"),e.cursorPosition.x++,e.cursorPosition.x==lines[e.cursorPosition.y].length+1&&(e.cursorPosition.x=0,e.cursorPosition.y=(e.cursorPosition.y+1)%lines.length),s(e)}function m(e){e.cursorPosition.x++,s(e)}function g(e){lines=e.currentTextBuffer.split("\n"),e.cursorPosition.x=0,e.cursorPosition.y=lines.length-1,s(e)}function y(e,t){lines=t.currentTextBuffer.split("\n"),lineNumber=Math.round(e*lines.length/100),b(lineNumber,t)}function b(e,t){t.cursorPosition.x=0,t.cursorPosition.y=e,s(t)}function w(e,t){this.type=e,this.name=t,this.transitions=[]}function E(e,t,n){this.acceptRule=e,this.nextState=t,this.action=n}function S(e){var t=e.repeatBuffer;t==""&&(t="0");var n=parseInt(t);return n<=0&&(n=1),n}function x(e,t){var n=S(t);switch(e){case"^":l(t,!0);break;case"$":f(t);break;case"h":while(n-->0)a(t);break;case"j":while(n-->0)u(t);break;case"k":while(n-->0)o(t);break;case"l":while(n-->0)m(t);break;case"w":while(n-->0)p(t);break;case"G":t.repeatBuffer==""?g(t):b(n-1,t);break;case"%":y(n,t)}}function T(e,t){var n=S(t);t.lastSearch=e;while(n-->0){var r=h(t),i=t.currentTextBuffer.slice(r+1)+"\n"+t.currentTextBuffer.slice(0,r+1)+t.currentTextBuffer.slice(r+1),s=new RegExp(e.slice(1)),o=-1;if(e.charAt(0)=="/")o=i.search(s);else if(e.charAt(0)=="?")for(var u=0;u<i.length;u++)o=i.slice(i.length-1-u).search(s),o>=0&&(o+=i.length-u-1,u=i.length);if(o<0){t.statusText=e.slice(1)+" not found.";return}while(o-->=0)v(t)}}function N(e){var t=S(e);P(e);while(t-->0){var n=h(e),r=e.currentTextBuffer.charAt(n);r==r.toUpperCase()?r=r.toLowerCase():r=r.toUpperCase();var i=e.currentTextBuffer.slice(0,n)+r+e.currentTextBuffer.slice(n+1);e.currentTextBuffer=i,v(e)}}function C(e,t){var n=h(t);t.simpleInsertBuffer+=e;var r=t.currentTextBuffer.slice(0,n)+e+t.currentTextBuffer.slice(n);t.cursorPosition.x+=e.length,t.currentTextBuffer=r,s(t)}function k(e,t){var n=S(t),r=h(t),i=0;P(t);while(n-->0){var o=t.currentTextBuffer.slice(0,r)+e+t.currentTextBuffer.slice(r);i+=e.length,t.cursorPosition.x+=e.length,t.currentTextBuffer=o}t.statusText="Inserted "+i+" character(s).",s(t)}function L(e){var t=h(e);t--;if(t>=0){var n=e.currentTextBuffer.slice(0,t)+e.currentTextBuffer.slice(t+1);e.cursorPosition.x--;if(e.cursorPosition.x<0){e.cursorPosition.y--;var r=e.currentTextBuffer.split("\n");e.cursorPosition.x=r[e.cursorPosition.y].length}e.currentTextBuffer=n,s(e)}}function A(e){var t=h(e),n=e.currentTextBuffer.slice(0,t)+e.currentTextBuffer.slice(t+1);e.currentTextBuffer=n,s(e)}function O(e,t,n){var r=c(e,n),i=c(t,n),o=h(n);P(n);if(r<i){for(var u=0;u<o-r;u++)d(n);n.copyBuffer=n.currentTextBuffer.slice(r,i);var a=n.currentTextBuffer.slice(0,r)+n.currentTextBuffer.slice(i);n.currentTextBuffer=a,n.statusText="Cut "+(i-r)+" character(s)."}else{for(var u=0;u<o-i;u++)d(n);n.copyBuffer=n.currentTextBuffer.slice(i,r);var a=n.currentTextBuffer.slice(0,i)+n.currentTextBuffer.slice(r);n.currentTextBuffer=a,n.statusText="Cut "+(r-i)+" character(s)."}s(n)}function _(e,t,n){var r=c(e,n),i=c(t,n);r<i?(n.copyBuffer=n.currentTextBuffer.substring(r,i),n.statusText="Copied "+(i-r)+" character(s)."):(n.copyBuffer=n.currentTextBuffer.substring(i,r),n.statusText="Copied "+(r-i)+" character(s).")}function D(e,t){lines=t.currentTextBuffer.split("\n");for(var n=0;n<e&&t.cursorPosition.y+n<lines.length;n++)t.copyBuffer+=lines[t.cursorPosition.y+n]+"\n";t.statusText="Copied "+n+" line(s)"}function P(e){e.undoBuffer.push(e.currentTextBuffer),e.redoBuffer=[]}function H(e){var t=S(e);P(e);while(t-->0){f(e);var n=h(e);if(e.currentTextBuffer[n+1]=="\n"){var r=e.currentTextBuffer.slice(0,n+1)+e.currentTextBuffer.slice(n+2);e.currentTextBuffer=r}}s(e)}function B(e){e.undoBuffer.length>0&&(e.redoBuffer.push(e.currentTextBuffer),e.currentTextBuffer=e.undoBuffer.pop(),
e.statusText="Undo"),s(e)}function j(e){e.redoBuffer.length>0&&(e.undoBuffer.push(e.currentTextBuffer),e.currentTextBuffer=e.redoBuffer.pop(),e.statusText="Redo"),s(e)}function F(e,t){var n=t.currentTextBuffer.split("\n");return n[e].length}function I(){return startState=new w(webvi_FSMSTATESTART,"start"),t=new E(/[0-9]/,startState,function(e,t){t.repeatBuffer+=e}),startState.transitions.push(t),yankStartState=new w(webvi_FSMSTATEMIDDLE,"yank-start"),t=new E(/y/,yankStartState,function(e,t){}),startState.transitions.push(t),t=new E(/[0-9]/,yankStartState,function(e,t){t.repeatBuffer+=e}),yankStartState.transitions.push(t),yankEndState=new w(webvi_FSMSTATEEND,"yank-end"),t=new E(/y/,yankEndState,function(e,t){var n=new Object,r=new Object,i=S(t);r.x=0,r.y=t.cursorPosition.y,n.x=F(t.cursorPosition.y+i-1,t)+1,n.y=t.cursorPosition.y+i-1,_(r,n,t)}),yankStartState.transitions.push(t),t=new E(/[hjkl^$Gw%]/,yankEndState,function(e,t){var n=new Object;n.x=t.cursorPosition.x,n.y=t.cursorPosition.y,x(e,t),_(n,t.cursorPosition,t)}),yankStartState.transitions.push(t),deleteStartState=new w(webvi_FSMSTATEMIDDLE,"delete-start"),t=new E(/[d]/,deleteStartState,function(e,t){}),startState.transitions.push(t),t=new E(/[0-9]/,deleteStartState,function(e,t){t.repeatBuffer+=e}),deleteStartState.transitions.push(t),deleteEndState=new w(webvi_FSMSTATEEND,"delete-end"),t=new E(/[d]/,deleteEndState,function(e,t){var n=new Object,r=new Object,i=S(t);r.x=0,r.y=t.cursorPosition.y,n.x=F(t.cursorPosition.y+i-1,t)+1,n.y=t.cursorPosition.y+i-1,O(r,n,t)}),deleteStartState.transitions.push(t),t=new E(/[hjkl^$Gw%]/,deleteEndState,function(e,t){var n=new Object;n.x=t.cursorPosition.x,n.y=t.cursorPosition.y,x(e,t),O(n,t.cursorPosition,t)}),deleteStartState.transitions.push(t),cutStartState=new w(webvi_FSMSTATEMIDDLE,"cut-start"),t=new E(/[c]/,cutStartState,function(e,t){}),startState.transitions.push(t),t=new E(/[0-9]/,cutStartState,function(e,t){t.repeatBuffer+=e}),cutStartState.transitions.push(t),cutEndState=new w(webvi_FSMSTATEEND,"cut-end"),t=new E(/[c]/,cutEndState,function(e,t){var n=new Object,r=new Object,i=S(t);r.x=0,r.y=t.cursorPosition.y,n.x=F(t.cursorPosition.y+i-1,t)+1,n.y=t.cursorPosition.y+i-1,O(r,n,t),C("\n",t),t.mode=webvi_EDITMODE,t.isSimpleInsert=!0,t.simpleInsertBuffer="",t.statusText="Insert Mode"}),cutStartState.transitions.push(t),t=new E(/[hjkl^$Gw%]/,cutEndState,function(e,t){var n=new Object;n.x=t.cursorPosition.x,n.y=t.cursorPosition.y,x(e,t),O(n,t.cursorPosition,t),t.mode=webvi_EDITMODE,t.isSimpleInsert=!0,t.simpleInsertBuffer="",t.statusText="Insert Mode"}),cutStartState.transitions.push(t),endState=new w(webvi_FSMSTATEEND,"end"),t=new E(/[hjkl^$Gw%]/,endState,function(e,t){x(e,t)}),startState.transitions.push(t),t=new E(/[0-9]/,startState,function(e,t){t.repeatBuffer+=e}),startState.transitions.push(t),t=new E(/x/,endState,function(e,t){var n=new Object,r=S(t);n.x=t.cursorPosition.x+r,n.y=t.cursorPosition.y,O(n,t.cursorPosition,t)}),startState.transitions.push(t),replaceStartState=new w(webvi_FSMSTATEMIDDLE,"replace-start"),t=new E(/r/,replaceStartState,function(e,t){}),startState.transitions.push(t),replaceEndState=new w(webvi_FSMSTATEEND,"replace-end"),t=new E(/./,replaceEndState,function(e,t){var n=new Object,r=S(t);n.x=t.cursorPosition.x+r,n.y=t.cursorPosition.y,O(n,t.cursorPosition,t),k(e,t)}),replaceStartState.transitions.push(t),insertEndState=new w(webvi_FSMSTATEEND,"insert-end"),t=new E(/[ia]/,insertEndState,function(e,t){e=="a"&&m(t),P(t),t.mode=webvi_EDITMODE,t.isSimpleInsert=!0,t.simpleInsertBuffer="",t.statusText="Insert Mode"}),startState.transitions.push(t),pasteEndState=new w(webvi_FSMSTATEEND,"paste-end"),t=new E(/p/,pasteEndState,function(e,t){t.copyBuffer.indexOf("\n")>0&&(t.cursorPosition.x=0,t.cursorPosition.y++),k(t.copyBuffer,t)}),startState.transitions.push(t),undoEndState=new w(webvi_FSMSTATEEND,"undo-end"),t=new E(/u/,undoEndState,function(e,t){B(t)}),startState.transitions.push(t),redoEndState=new w(webvi_FSMSTATEEND,"redo-end"),t=new E(/R/,redoEndState,function(e,t){j(t)}),startState.transitions.push(t),joinEndState=new w(webvi_FSMSTATEEND,"join-end"),t=new E(/J/,joinEndState,function(e,t){H(t)}),startState.transitions.push(t),oEndState=new w(webvi_FSMSTATEEND,"o-end"),t=new E(/o/,oEndState,function(e,t){P(t),u(t),l(t,!1),t.mode=webvi_EDITMODE,C("\n",t),t.isSimpleInsert=!0,t.simpleInsertBuffer="",t.statusText="Insert Mode"}),startState.transitions.push(t),capsEndState=new w(webvi_FSMSTATEEND,"caps-end"),t=new E(/~/,capsEndState,function(e,t){N(t)}),startState.transitions.push(t),repeatSearchEndState=new w(webvi_FSMSTATEEND,"repeat-search-end"),t=new E(/n/,repeatSearchEndState,function(e,t){T(t.lastSearch,t)}),startState.transitions.push(t),startSearchEndState=new w(webvi_FSMSTATEMIDDLE,"start-search-end"),t=new E(/[\/\?]/,startSearchEndState,function(e,t){t.mode=webvi_COMMANDMODE,t.statusText="",t.commandBuffer=e}),startState.transitions.push(t),startState}function q(e,t,n){current=e;for(var r=0;r<t.length;r++){foundTransition=!1;for(var i=0;i<current.transitions.length&&!foundTransition;i++)if(current.transitions[i].acceptRule.test(t.charAt(r))){foundTransition=!0,current.transitions[i].action(t.charAt(r),n),current=current.transitions[i].nextState;continue}if(!foundTransition)return new w(webvi_FSMSTATEERROR,"error")}return current}function R(e){fsm=I(),e.repeatBuffer="",finalState=q(fsm,e.commandBuffer,e),finalState.type==webvi_FSMSTATEERROR&&(e.statusText="Invalid command: "+e.commandBuffer,e.commandBuffer=""),finalState.type==webvi_FSMSTATEEND&&(e.commandBuffer="")}function U(e,t){t.commandBuffer+=e,R(t)}function z(e){var t="",n=e.keyCode;n==0&&(n=e.charCode);if(e.shiftKey){if(n>=65&&n<=90)return String.fromCharCode(n);switch(n){case 192:return"~";case 49:return"!";case 50:return"@";case 51:return"#";case 52:return"$";case 53:return"%";case 54:return"^";case 55:return"&";case 56:return"*";case 57:return"(";case 48:return")";case 189:return"_";case 61:return"+";case 219
:return"{";case 221:return"}";case 220:return"|";case 186:case 59:return":";case 222:return'"';case 188:return"<";case 190:return">";case 191:return"?";case 20:return" ";case 42:return"*";case 187:return"+"}}else{if(n>=65&&n<=90)return String.fromCharCode(n+32);switch(n){case 192:return"`";case 187:case 61:return"=";case 189:return"-";case 219:return"[";case 221:return"]";case 220:return"\\";case 186:case 59:return";";case 222:return"'";case 188:return",";case 190:return".";case 191:return"/";case 111:return"/";case 106:return"*";case 109:return"-";case 107:return"+";case 96:case 48:return"0";case 97:case 49:return"1";case 98:case 50:return"2";case 99:case 51:return"3";case 100:case 52:return"4";case 101:case 53:return"5";case 102:case 54:return"6";case 103:case 55:return"7";case 104:case 56:return"8";case 105:case 57:return"9";case 32:return" "}}return t}function W(e,t){var n=z(e);switch(t.mode){case webvi_VISUALMODE:if(n!="")n=="r"&&e.ctrlKey&&(n="R"),U(n,t);else if(e.keyCode>0)switch(e.keyCode){case 46:U("x",t);break;case 40:U("j",t);break;case 38:U("k",t);break;case 37:case 8:U("h",t);break;case 39:U("l",t)}break;case webvi_EDITMODE:if(n!="")C(n,t);else if(e.keyCode>0)switch(e.keyCode){case 27:t.mode=webvi_VISUALMODE;var r=S(t),i=t.simpleInsertBuffer;while(r-->1)C(i,t);t.statusText="Visual Mode";break;case 46:A(t);break;case 8:L(t);break;case 40:t.isSimpleInsert=!1,u(t),t.statusText="";break;case 38:t.isSimpleInsert=!1,o(t),t.statusText="";break;case 37:t.isSimpleInsert=!1,a(t),t.statusText="";break;case 39:t.isSimpleInsert=!1,m(t),t.statusText="";break;case 13:C("\n",t),u(t),l(t,!1),t.statusText=""}break;case webvi_COMMANDMODE:if(n!="")t.commandBuffer+=n;else if(e.keyCode>0)switch(e.keyCode){case 27:t.mode=webvi_VISUALMODE,t.statusText="Visual Mode",t.commandBuffer="";break;case 13:t.mode=webvi_VISUALMODE,t.statusText="Search: "+t.commandBuffer,T(t.commandBuffer,t),t.commandBuffer="";break;case 37:break;case 39:break;case 8:t.commandBuffer=t.commandBuffer.slice(0,t.commandBuffer.length-2)}}K(t)}function X(e){for(var t=0;t<webvi_stateList.length;t++)if(webvi_stateList[t].canvasNode==e.target){W(e,state);break}e.preventDefault()}function V(e){e.currentTextBuffer=e.currentTextBuffer.replace("\r\n","\n");var t=e.currentTextBuffer.split("\n"),n=0,r=0;for(var i=0;i<e.windowSize.height;i++){e.lineWrap[i]=!1;for(var s=0;s<e.windowSize.width;s++)e.displayBuffer[s][i]=" "}var o=0,u=!1;for(o=0;o<t.length&&r<e.windowSize.height;o++){for(n=0;n<t[o].length;n++)n>0&&n%e.windowSize.width==0&&(e.lineWrap[r]=!0,r++),e.displayBuffer[n%e.windowSize.width][r]=t[o][n],o==e.cursorPosition.y&&n==e.cursorPosition.x&&(e.displayCursorPosition.x=n%e.windowSize.width,e.displayCursorPosition.y=r,u=!0);e.displayBuffer[n%e.windowSize.width][r]="\n",o==e.cursorPosition.y&&n==e.cursorPosition.x&&(e.displayCursorPosition.x=n%e.windowSize.width,e.displayCursorPosition.y=r,u=!0),r++}u||(e.displayCursorPosition.x=n%e.windowSize.width,e.displayCursorPosition.y=r-1)}function $(e,t,n){this.hiddenInput=e,this.canvasNode=t,this.options=new r,this.currentTextBuffer=e.value,this.cursorPosition=new Object,this.cursorPosition.x=0,this.cursorPosition.y=0,this.displayCursorPosition=new Object,this.displayCursorPosition.x=0,this.displayCursorPosition.y=0,this.windowSize=new Object,this.windowSize.width=n.getAttribute("cols"),this.windowSize.height=n.getAttribute("rows")-1,this.mode=webvi_VISUALMODE,this.commandBuffer="",this.copyBuffer="",this.lastSearch="",this.repeatBuffer="",this.characterSize=new Object,this.characterSize.width=(t.getAttribute("width")-this.options.borderWidth*2-this.options.paddingWidth*2)/this.windowSize.width,this.characterSize.height=(t.getAttribute("height")-this.options.borderWidth*2-this.options.paddingWidth*2)/(this.windowSize.height+1),this.statusText="Ready: "+this.currentTextBuffer.split("\n").length+"L, "+this.currentTextBuffer.length+"C",this.undoBuffer=[],this.redoBuffer=[],this.simpleInsertBuffer="",this.isSimpleInsert=!0,this.displayBuffer=new Array(this.windowSize.width);for(var i=0;i<this.windowSize.width;i++)this.displayBuffer[i]=new Array(this.windowSize.height);this.lineWrap=new Array(this.windowSize.height),V(this)}function J(){window.onload=Y}function K(e){context=e.canvasNode.getContext("2d"),context.fillStyle=e.options.borderColor,context.fillRect(0,0,e.canvasNode.width,e.canvasNode.height),context.fillStyle=e.options.backgroundColor,context.fillRect(e.options.borderWidth,e.options.borderWidth,e.canvasNode.width-e.options.borderWidth*2,e.canvasNode.height-e.options.borderWidth*2),context.font=e.options.font,context.fillStyle=e.options.textColor;for(var t=0;t<e.windowSize.height;t++){for(var n=0;n<e.windowSize.width;n++)n==e.displayCursorPosition.x&&t==e.displayCursorPosition.y&&e.mode!=webvi_COMMANDMODE?(e.displayBuffer[n][t]=="\n"?context.fillStyle=e.options.eolCursorColor:e.mode==webvi_VISUALMODE?context.fillStyle=e.options.visualCursorColor:e.mode==webvi_EDITMODE&&(context.fillStyle=e.options.editCursorColor),context.fillRect(e.characterSize.width*n+e.options.borderWidth+e.options.paddingWidth,e.characterSize.height*t+e.options.borderWidth+e.options.paddingWidth+4,e.characterSize.width,e.characterSize.height),context.fillStyle=e.options.backgroundColor,context.fillText(e.displayBuffer[n][t],e.characterSize.width*n+e.options.borderWidth+e.options.paddingWidth,e.characterSize.height*(t+1)+e.options.borderWidth+e.options.paddingWidth),context.fillStyle=e.options.textColor):context.fillText(e.displayBuffer[n][t],e.characterSize.width*n+e.options.borderWidth+e.options.paddingWidth,e.characterSize.height*(t+1)+e.options.borderWidth+e.options.paddingWidth);e.lineWrap[t]==1&&(context.strokeStyle=e.options.lineWrapColor,context.lineWidth=e.options.borderWidth,context.beginPath(),context.moveTo(e.canvasNode.width-e.options.borderWidth/2,e.characterSize.height*t+e.options.borderWidth+e.options.paddingWidth+4),context.lineTo(e.canvasNode.width-e.options.borderWidth/2,e.characterSize.height*(t+1)+
e.options.borderWidth+e.options.paddingWidth+1),context.stroke())}context.fillStyle=e.options.statusBackgroundColor,context.fillRect(e.options.borderWidth,e.canvasNode.height-e.options.borderWidth-e.characterSize.height,e.canvasNode.width-e.options.borderWidth*2,e.characterSize.height),context.fillStyle=e.options.statusTextColor,e.mode==webvi_COMMANDMODE?context.fillText(e.commandBuffer,e.options.borderWidth+e.options.paddingWidth,e.canvasNode.height-e.options.borderWidth-e.options.paddingWidth):context.fillText(e.statusText,e.options.borderWidth+e.options.paddingWidth,e.canvasNode.height-e.options.borderWidth-e.options.paddingWidth)}function Q(e){return canvasNode=document.createElement("canvas"),widthAttribute=document.createAttribute("width"),widthAttribute.nodeValue=e.clientWidth,canvasNode.setAttributeNode(widthAttribute),heightAttribute=document.createAttribute("height"),heightAttribute.nodeValue=e.clientHeight,canvasNode.setAttributeNode(heightAttribute),tabIndexAttribute=document.createAttribute("tabindex"),tabIndexAttribute.nodeValue=0,canvasNode.setAttributeNode(tabIndexAttribute),canvasNode}function G(e){return hiddenInput=document.createElement("input"),typeAttribute=document.createAttribute("type"),typeAttribute.nodeValue="hidden",hiddenInput.setAttributeNode(typeAttribute),textareaName=e.getAttribute("name"),nameAttribute=document.createAttribute("name"),nameAttribute.nodeValue=textareaName,hiddenInput.setAttributeNode(nameAttribute),textareaId=e.getAttribute("id"),idAttribute=document.createAttribute("id"),idAttribute.nodeValue=textareaId,hiddenInput.setAttributeNode(idAttribute),textareaValue=e.value,valueAttribute=document.createAttribute("value"),valueAttribute.nodeValue=textareaValue,hiddenInput.setAttributeNode(valueAttribute),hiddenInput}function Y(){eles=document.getElementsByTagName("textarea");for(var e=0;e<eles.length;e++)eles[e].className.indexOf("webvi")>=0&&(textareaNode=eles[e],hiddenInput=G(textareaNode),canvas=Q(textareaNode),parentEle=eles[e].parentNode,parentEle.replaceChild(canvas,textareaNode),parentEle.appendChild(hiddenInput),state=new $(hiddenInput,canvas,textareaNode),webvi_stateList.push(state),K(state),canvas.addEventListener("keydown",X,!1))}Array.prototype.clone=function(){var e=new Array;for(var t in this)e[t]=typeof this[t]=="object"?this[t].clone():this[t];return e},webvi_stateList=[],webvi_COMMANDMODE=0,webvi_EDITMODE=1,webvi_VISUALMODE=2,webvi_FSMSTATESTART=0,webvi_FSMSTATEMIDDLE=1,webvi_FSMSTATEEND=2,webvi_FSMSTATEERROR=3,M.editor_webvi=M.editor_webvi||{init:function(t){var n=e.one("#"+t),r=G(textareaNode),s=Q(textareaNode),o=eles[i].parentNode;o.replaceChild(s,textareaNode),o.appendChild(r);var u=new $(r,s,textareaNode);webvi_stateList.push(u),K(u),s.addEventListener("keydown",X,!1)}}},"@VERSION@",{requires:["node","io","overlay","escape"]});
